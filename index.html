<!DOCTYPE html>
<!-- saved from url=(0045)https://moshhhhhh.github.io/Chord-dictionary/ -->
<html lang="he" dir="rtl">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×œ×™××•×“ ××§×•×¨×“×™× ×œ×¤×¡× ×ª×¨</title>
    <style>
        /* --- ×”×’×“×¨×•×ª ×›×œ×œ×™×•×ª ×•××™×¤×•×¡ --- */
        :root {
            --blue-500: #3b82f6;
            --blue-600: #2563eb;
            --blue-700: #1d4ed8;
            --blue-50: #eff6ff;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --white: #ffffff;
            --black: #000000;

            /* Piano key dimensions - Adjusted for better realism */
            --white-key-width: 45px; /* Slightly wider white keys */
            --black-key-width: 28px; /* Proportionally sized black keys */
            --black-key-height: 90px; /* Shorter than white keys */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            background-color: #f0f2f5;
            color: var(--gray-800);
            margin: 0;
            padding: 1rem;
        }

        * {
            box-sizing: border-box;
        }

        /* --- ××‘× ×” ×›×œ×œ×™ --- */
        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        main {
            display: grid;
            gap: 2rem;
        }

        @media (min-width: 1024px) {
            main {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* --- ×›×¨×˜×™×¡×™×•×ª --- */
        .card {
            background-color: var(--white);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .card h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-700);
            border-bottom: 2px solid var(--gray-100);
            padding-bottom: 0.5rem;
            margin: -1.5rem -1.5rem 0 -1.5rem;
            padding: 0 1.5rem 0.5rem 1.5rem;
        }

        .card h3 {
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 0.75rem;
        }

        /* --- ×›×¤×ª×•×¨×™× --- */
        .btn {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
        }
        .btn:focus {
            outline: 2px solid var(--blue-500);
            outline-offset: 2px;
        }

        .btn-primary {
            background-color: var(--blue-500);
            color: var(--white);
        }
        .btn-primary:hover {
            background-color: var(--blue-600);
        }

        .btn-secondary {
            background-color: var(--gray-200);
            color: var(--gray-800);
        }
        .btn-secondary:hover {
            background-color: var(--gray-300);
        }

        .btn-active {
            background-color: var(--blue-600);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 0 0 2px var(--white), 0 0 0 4px var(--blue-500);
        }

        #help-btn {
            background-color: var(--white);
            border-radius: 9999px;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--blue-500);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        #help-btn:hover {
            transform: scale(1.1);
        }

        /* --- ×¨×©×ª×•×ª ×›×¤×ª×•×¨×™× ×•×§×œ×˜ --- */
        .button-grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }
        .button-grid-auto {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.5rem;
        }
        .flex-group {
            display: flex;
            gap: 0.75rem;
        }
        #manual-input {
            flex-grow: 1;
            padding: 0.5rem 0.75rem;
            border: 2px solid var(--gray-300);
            border-radius: 0.5rem;
            transition: border-color 0.2s;
            font-size: 1rem;
        }
        #manual-input:focus {
            outline: none;
            border-color: var(--blue-500);
        }

        /* --- ××–×•×¨ ×”×¤×œ×˜ --- */
        #chord-display-wrapper {
            text-align: center;
            background-color: var(--blue-50);
            padding: 1rem;
            border-radius: 0.5rem;
        }
        #chord-display {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--blue-700);
        }
        .output-box {
            background-color: var(--gray-100);
            padding: 1rem;
            border-radius: 0.375rem;
            min-height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        #chord-notes {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-800);
            direction: ltr;
        }
        #chord-aliases {
            font-size: 1.125rem;
            color: var(--gray-700);
            direction: ltr;
        }
         #chord-explanation {
            font-size: 1.125rem;
            color: var(--gray-700);
        }
        
        /* --- ×—×œ×•×Ÿ ×¢×–×¨×” (××•×“××œ) --- */
        #modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s;
            z-index: 100;
        }
        #modal-backdrop.visible {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease;
        }
        #help-modal {
            max-width: 500px;
            width: 90%;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        #modal-backdrop.visible #help-modal {
            transform: scale(1);
        }
        #help-modal ul {
            list-style-position: inside;
            padding-right: 0.5rem;
        }
        #help-modal p, #help-modal ul {
            color: var(--gray-700);
            margin-bottom: 1rem;
        }

        /* --- Piano Visualization Styles --- */
        #piano-visualization {
            position: relative;
            width: calc(7 * var(--white-key-width)); /* Width for one octave of white keys */
            height: 150px; /* Adjust height as needed */
            margin: 1.5rem auto; /* Center the piano horizontally */
            background-color: var(--gray-800);
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .key {
            position: absolute; /* All keys will be absolutely positioned */
            border: 1px solid var(--gray-500);
            box-sizing: border-box;
            border-radius: 0 0 5px 5px;
            transition: background-color 0.1s ease-out;
            cursor: pointer; /* Indicate interactivity */
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 5px;
            font-size: 0.75rem;
            user-select: none;
        }

        .white-key {
            background-color: var(--white);
            width: var(--white-key-width);
            height: 100%;
            z-index: 1;
            border-color: var(--gray-300);
            top: 0; /* Align white keys to the top */
        }

        .black-key {
            background-color: var(--black);
            width: var(--black-key-width);
            height: var(--black-key-height);
            z-index: 2;
            border-color: var(--gray-600);
            color: var(--white);
            top: 0; /* Align black keys to the top */
            border-radius: 0 0 3px 3px;
        }

        /* Specific positioning for white keys */
        .white-key[data-note="C"] { left: calc(0 * var(--white-key-width)); }
        .white-key[data-note="D"] { left: calc(1 * var(--white-key-width)); }
        .white-key[data-note="E"] { left: calc(2 * var(--white-key-width)); }
        .white-key[data-note="F"] { left: calc(3 * var(--white-key-width)); }
        .white-key[data-note="G"] { left: calc(4 * var(--white-key-width)); }
        .white-key[data-note="A"] { left: calc(5 * var(--white-key-width)); }
        .white-key[data-note="B"] { left: calc(6 * var(--white-key-width)); }

        /* Specific positioning for black keys - Adjusted for realism */
        /* C# is positioned between C and D */
        .black-key[data-note="C#"] { left: calc(var(--white-key-width) - var(--black-key-width) / 2); }
        /* D# is positioned between D and E */
        .black-key[data-note="D#"] { left: calc(2 * var(--white-key-width) - var(--black-key-width) / 2); }
        /* F# is positioned between F and G */
        .black-key[data-note="F#"] { left: calc(4 * var(--white-key-width) - var(--black-key-width) / 2); }
        /* G# is positioned between G and A */
        .black-key[data-note="G#"] { left: calc(5 * var(--white-key-width) - var(--black-key-width) / 2); }
        /* A# is positioned between A and B */
        .black-key[data-note="A#"] { left: calc(6 * var(--white-key-width) - var(--black-key-width) / 2); }


        .key.highlight {
            background-color: var(--blue-500);
            box-shadow: 0 0 10px var(--blue-500);
            border-color: var(--blue-700);
        }
        .white-key.highlight {
            color: var(--white); /* White text on highlighted white key */
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            :root {
                --white-key-width: 35px; /* Adjusted for tablet */
                --black-key-width: 22px;
                --black-key-height: 75px;
            }
        }
        @media (max-width: 480px) {
            :root {
                --white-key-width: 30px; /* Adjusted for mobile */
                --black-key-width: 18px;
                --black-key-height: 60px;
            }
            .key {
                font-size: 0.55rem;
                padding-bottom: 2px;
            }
        }

    </style>
</head>
<body>

    <div class="container">
        <!-- ×›×•×ª×¨×ª ×¨××©×™×ª ×•×›×¤×ª×•×¨ ×¢×–×¨×” -->
        <header>
            <h1>×œ×™××•×“ ××§×•×¨×“×™× ×œ×¤×¡× ×ª×¨</h1>
            <button id="help-btn">?</button>
        </header>

        <main>
            <!-- ××–×•×¨ ×”×§×œ×˜ -->
            <div id="input-area" class="card">
                <h2>×‘×—×™×¨×ª ××§×•×¨×“</h2>
                
                <div>
                    <h3>1. ×ª×• ×‘×¡×™×¡ (Root)</h3>
                    <div id="root-note-selector" class="button-grid-4">
                        <button data-note="C" class="btn btn-secondary btn-active">C</button>
                        <button data-note="D" class="btn btn-secondary">D</button>
                        <button data-note="E" class="btn btn-secondary">E</button>
                        <button data-note="F" class="btn btn-secondary">F</button>
                        <button data-note="G" class="btn btn-secondary">G</button>
                        <button data-note="A" class="btn btn-secondary">A</button>
                        <button data-note="B" class="btn btn-secondary">B</button>
                    </div>
                </div>

                <div>
                    <h3>2. ×¡×™×× ×™ ×”×™×ª×§ (Accidentals)</h3>
                    <div id="accidental-selector" class="flex-group">
                        <button data-accidental="" class="btn btn-secondary">×¨×’×™×œ</button>
                        <button data-accidental="b" class="btn btn-secondary">â™­ (×‘××•×œ)</button>
                        <button data-accidental="#" class="btn btn-secondary">â™¯ (×“×™××–)</button>
                    </div>
                </div>

                <div>
                    <h3>3. ×¡×•×’ ×”××§×•×¨×“ (Type)</h3>
                    <div id="type-selector" class="button-grid-auto">
                        <button data-type="maj" class="btn btn-secondary btn-active">××–'×•×¨</button>
                        <button data-type="min" class="btn btn-secondary">××™× ×•×¨</button>
                        <button data-type="dim" class="btn btn-secondary">××•×§×˜×Ÿ (dim)</button>
                        <button data-type="aug" class="btn btn-secondary">××•×’×“×œ (aug)</button>
                        <button data-type="7" class="btn btn-secondary">7</button>
                        <button data-type="maj7" class="btn btn-secondary">Maj7</button>
                        <button data-type="min7" class="btn btn-secondary">m7</button>
                        <button data-type="sus2" class="btn btn-secondary">sus2</button>
                        <button data-type="sus4" class="btn btn-secondary">sus4</button>
                        <button data-type="6" class="btn btn-secondary">6</button>
                        <button data-type="m6" class="btn btn-secondary">m6</button>
                        <button data-type="dim7" class="btn btn-secondary">dim7</button>
                        <button data-type="m7b5" class="btn btn-secondary">m7b5</button>
                    </div>
                </div>
                
                <div style="border-top: 2px solid var(--gray-100); padding-top: 1.5rem;">
                     <h3>××•: ×”×§×œ×“×” ×™×“× ×™×ª</h3>
                     <div class="flex-group">
                         <input type="text" id="manual-input" placeholder="×œ×“×•×’××”: C#m7 ××• Gb">
                         <button id="manual-submit" class="btn btn-primary">×”×¦×’</button>
                     </div>
                </div>
            </div>

            <!-- ××–×•×¨ ×”×¤×œ×˜ -->
            <div id="output-area" class="card">
                <h2>×ª×•×¦××”</h2>
                
                <div id="chord-display-wrapper">
                    <span id="chord-display"><span dir="ltr">C</span></span>
                </div>

                <div>
                    <h3>ğŸµ ××¨×›×™×‘×™ ×”××§×•×¨×“</h3>
                    <div id="chord-notes" class="output-box">C - E - G</div>
                </div>

                <div>
                    <h3>ğŸ”„ ×©××•×ª × ×•×¡×¤×™× (×× ×”×¨××•× ×™×”)</h3>
                    <div id="chord-aliases" class="output-box">××™×Ÿ</div>
                </div>

                <div>
                    <h3>ğŸ“– ×”×¡×‘×¨ ×¢×œ ××‘× ×” ×”××§×•×¨×“</h3>
                    <div id="chord-explanation" class="output-box">××•×¨×›×‘ ××ª×• ×‘×¡×™×¡, ×˜×¨×¦×” ×’×“×•×œ×” (4 ×—×¦××™ ×˜×•× ×™×) ×•×§×•×•×™× ×˜×” ×–×›×” (7 ×—×¦××™ ×˜×•× ×™×).</div>
                </div>

                <!-- Piano Visualization Section -->
                <div>
                    <h3>ğŸ¹ ×”×¦×’×” ×—×–×•×ª×™×ª ×¢×œ ×¤×¡× ×ª×¨</h3>
                    <div id="piano-visualization">
                        <!-- White keys for one octave (C to B) -->
                        <div class="key white-key" data-note="C">C</div>
                        <div class="key white-key" data-note="D">D</div>
                        <div class="key white-key" data-note="E">E</div>
                        <div class="key white-key" data-note="F">F</div>
                        <div class="key white-key" data-note="G">G</div>
                        <div class="key white-key" data-note="A">A</div>
                        <div class="key white-key" data-note="B">B</div>
                        
                        <!-- Black keys for one octave -->
                        <div class="key black-key" data-note="C#">C#</div>
                        <div class="key black-key" data-note="D#">D#</div>
                        <div class="key black-key" data-note="F#">F#</div>
                        <div class="key black-key" data-note="G#">G#</div>
                        <div class="key black-key" data-note="A#">A#</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ×—×œ×•×Ÿ ×¢×–×¨×” (××•×“××œ) -->
    <div id="modal-backdrop" class="">
        <div id="help-modal" class="card">
            <h2>××•×“×•×ª ×”××¤×œ×™×§×¦×™×”</h2>
            <p>
                ×‘×¨×•×›×™× ×”×‘××™× ×œ××¤×œ×™×§×¦×™×” ×œ×œ×™××•×“ ××§×•×¨×“×™×!
                <br>
                ×›××Ÿ ×ª×•×›×œ×• ×œ×œ××•×“ ×›×™×¦×“ ×œ×‘× ×•×ª ×›×œ ××§×•×¨×“ × ×¤×•×¥.
            </p>
            <h3>××™×š ××©×ª××©×™×?</h3>
            <p>
                <strong>×‘×—×™×¨×” ×œ×¤×™ ×¨×›×™×‘×™×:</strong> ×‘×—×¨×• ××ª ×ª×• ×”×‘×¡×™×¡, ×¡×™××Ÿ ×”×™×ª×§ (×‘××•×œ/×“×™××–) ×•×¡×•×’ ×”××§×•×¨×“. ×”×ª×•×¦××” ×ª×ª×¢×“×›×Ÿ ××•×˜×•××˜×™×ª.
                <br>
                <strong>×”×§×œ×“×” ×™×“× ×™×ª:</strong> ×›×ª×‘×• ××ª ×©× ×”××§×•×¨×“ ×”××œ× ×‘×ª×™×‘×ª ×”×˜×§×¡×˜ (×œ×“×•×’××”: F#m7, Bb, Dsus4) ×•×œ×—×¦×• "×”×¦×’".
            </p>
             <h3>××” ×¨×•××™× ×‘×ª×•×¦××”?</h3>
            <ul>
                <li><strong>××¨×›×™×‘×™ ×”××§×•×¨×“:</strong> ×”×ª×•×•×™× ×”××“×•×™×§×™× ×©××¨×›×™×‘×™× ××ª ×”××§×•×¨×“.</li>
                <li><strong>×©××•×ª × ×•×¡×¤×™×:</strong> ×©××•×ª ×× ×”×¨××•× ×™×™× ×œ××§×•×¨×“, ×× ×§×™×™××™×.</li>
                <li><strong>×”×¡×‘×¨ ×¢×œ ×”××‘× ×”:</b> ×”× ×•×¡×—×” ×•×”××¨×•×•×—×™× ×©×™×•×¦×¨×™× ××ª ×¡×•×’ ×”××§×•×¨×“.</li>
                <li><strong>×”×¦×’×” ×—×–×•×ª×™×ª ×¢×œ ×¤×¡× ×ª×¨:</strong> ×ª×¦×•×’×” ×’×¨×¤×™×ª ×©×œ ×”××§×•×¨×“ ×¢×œ ×§×œ×™×“×™ ×”×¤×¡× ×ª×¨.</li>
            </ul>
            <div style="text-align: center; font-size: 0.875rem; color: var(--gray-500); padding-top: 1rem; border-top: 1px solid var(--gray-200);">
                <p>× ×•×¦×¨×” ×¢×‘×•×¨ ×™.×“.</p>
                <p>×¤×•×ª×— ×‘×××¦×¢×•×ª Gemini ğŸ›¡ï¸</p>
            </div>
            <button id="close-modal-btn" class="btn btn-primary" style="margin-top: 1rem; width: 100%;">×”×‘× ×ª×™, ×ª×•×“×”!</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ×”×’×“×¨×•×ª ×•× ×ª×•× ×™× ---
            const NOTES = {
                sharp: ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'],
                flat:  ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B']
            };

            // Mapping for piano key display (always uses sharps for black keys internally for consistent visual mapping)
            const PIANO_NOTES_ORDER = [
                'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'
            ];

            const CHORD_FORMULAS = {
                maj:   { name: '××–\'×•×¨', intervals: [0, 4, 7], explanation: '××•×¨×›×‘ ××ª×• ×‘×¡×™×¡, ×˜×¨×¦×” ×’×“×•×œ×” (4 ×—×¦××™ ×˜×•× ×™×) ×•×§×•×•×™× ×˜×” ×–×›×” (7 ×—×¦××™ ×˜×•× ×™×).' },
                min:   { name: '××™× ×•×¨', intervals: [0, 3, 7], explanation: '××•×¨×›×‘ ××ª×• ×‘×¡×™×¡, ×˜×¨×¦×” ×§×˜× ×” (3 ×—×¦××™ ×˜×•× ×™×) ×•×§×•×•×™× ×˜×” ×–×›×” (7 ×—×¦××™ ×˜×•× ×™×).' },
                dim:   { name: '××•×§×˜×Ÿ (diminished)', intervals: [0, 3, 6], explanation: '××•×¨×›×‘ ××ª×• ×‘×¡×™×¡, ×˜×¨×¦×” ×§×˜× ×” (3 ×—×¦××™ ×˜×•× ×™×) ×•×§×•×•×™× ×˜×” ××•×§×˜× ×ª (6 ×—×¦××™ ×˜×•× ×™×).' },
                aug:   { name: '××•×’×“×œ (augmented)', intervals: [0, 4, 8], explanation: '××•×¨×›×‘ ××ª×• ×‘×¡×™×¡, ×˜×¨×¦×” ×’×“×•×œ×” (4 ×—×¦××™ ×˜×•× ×™×) ×•×§×•×•×™× ×˜×” ××•×’×“×œ×ª (8 ×—×¦××™ ×˜×•× ×™×).' },
                '7':     { name: '×“×•××™× × ×˜×™ (7)', intervals: [0, 4, 7, 10], explanation: '××§×•×¨×“ ××–\'×•×¨ ×¢× ×ª×•×¡×¤×ª ×©×œ ×¡×¤×˜×™××” ×§×˜× ×” (10 ×—×¦××™ ×˜×•× ×™×).' },
                maj7:  { name: '××–\'×•×¨ 7', intervals: [0, 4, 7, 11], explanation: '××§×•×¨×“ ××–\'×•×¨ ×¢× ×ª×•×¡×¤×ª ×©×œ ×¡×¤×˜×™××” ×’×“×•×œ×” (11 ×—×¦××™ ×˜×•× ×™×).' },
                min7:  { name: '××™× ×•×¨ 7', intervals: [0, 3, 7, 10], explanation: '××§×•×¨×“ ××™× ×•×¨ ×¢× ×ª×•×¡×¤×ª ×©×œ ×¡×¤×˜×™××” ×§×˜× ×” (10 ×—×¦××™ ×˜×•× ×™×).' },
                sus2:  { name: 'sus2', intervals: [0, 2, 7], explanation: '××§×•×¨×“ ×‘×• ×”×˜×¨×¦×” ××•×—×œ×¤×ª ×‘×¡×§×•× ×“×” ×’×“×•×œ×” (2 ×—×¦××™ ×˜×•× ×™×).' },
                sus4:  { name: 'sus4', intervals: [0, 5, 7], explanation: '××§×•×¨×“ ×‘×• ×”×˜×¨×¦×” ××•×—×œ×¤×ª ×‘×§×•×•×¨×˜×” ×–×›×” (5 ×—×¦××™ ×˜×•× ×™×).' },
                '6':     { name: '××–\'×•×¨ 6', intervals: [0, 4, 7, 9], explanation: '××§×•×¨×“ ××–\'×•×¨ ×¢× ×ª×•×¡×¤×ª ×©×œ ×¡×§×¡×˜×” ×’×“×•×œ×” (9 ×—×¦××™ ×˜×•× ×™×).' },
                m6:    { name: '××™× ×•×¨ 6', intervals: [0, 3, 7, 9], explanation: '××§×•×¨×“ ××™× ×•×¨ ×¢× ×ª×•×¡×¤×ª ×©×œ ×¡×§×¡×˜×” ×’×“×•×œ×” (9 ×—×¦××™ ×˜×•× ×™×).' },
                dim7:  { name: '××•×§×˜×Ÿ 7', intervals: [0, 3, 6, 9], explanation: '××§×•×¨×“ ××•×§×˜×Ÿ ×¢× ×ª×•×¡×¤×ª ×©×œ ×¡×¤×˜×™××” ××•×§×˜× ×ª (9 ×—×¦××™ ×˜×•× ×™×).' },
                m7b5:  { name: '×—×¦×™ ××•×§×˜×Ÿ (m7b5)', intervals: [0, 3, 6, 10], explanation: '××§×•×¨×“ ××•×§×˜×Ÿ ×¢× ×ª×•×¡×¤×ª ×©×œ ×¡×¤×˜×™××” ×§×˜× ×” (10 ×—×¦××™ ×˜×•× ×™×).' }
            };

            const ENHARMONICS = {
                'C#': 'Db', 'Db': 'C#', 'D#': 'Eb', 'Eb': 'D#', 'F#': 'Gb', 'Gb': 'F#',
                'G#': 'Ab', 'Ab': 'G#', 'A#': 'Bb', 'Bb': 'A#'
            };

            let currentChord = { root: 'C', accidental: '', type: 'maj' };

            const rootSelector = document.getElementById('root-note-selector');
            const accidentalSelector = document.getElementById('accidental-selector');
            const typeSelector = document.getElementById('type-selector');
            const manualInput = document.getElementById('manual-input');
            const manualSubmit = document.getElementById('manual-submit');
            
            const chordDisplay = document.getElementById('chord-display');
            const chordNotesEl = document.getElementById('chord-notes');
            const chordAliasesEl = document.getElementById('chord-aliases');
            const chordExplanationEl = document.getElementById('chord-explanation');
            const pianoKeys = document.querySelectorAll('#piano-visualization .key');

            const helpBtn = document.getElementById('help-btn');
            const modalBackdrop = document.getElementById('modal-backdrop');
            const closeModalBtn = document.getElementById('close-modal-btn');

            function updateDisplay() {
                const { root, accidental, type } = currentChord;
                const fullRoot = root + accidental;
                const formula = CHORD_FORMULAS[type];

                if (!formula) {
                    displayError('×¡×•×’ ××§×•×¨×“ ×œ× ×™×“×•×¢.');
                    return;
                }
                
                const rootIndexSharp = NOTES.sharp.indexOf(fullRoot);
                const rootIndexFlat = NOTES.flat.indexOf(fullRoot);
                
                if (rootIndexSharp === -1 && rootIndexFlat === -1) {
                    displayError('×ª×• ×‘×¡×™×¡ ×œ× ×ª×§×™×Ÿ.');
                    return;
                }

                let useSharp;
                if (accidental === 'b') {
                    useSharp = false;
                } else if (accidental === '#') {
                    useSharp = true;
                } else { // Natural root note
                    useSharp = root !== 'F';
                }

                const rootIndex = useSharp ? rootIndexSharp : rootIndexFlat;
                const scale = useSharp ? NOTES.sharp : NOTES.flat;
                
                if (rootIndex === -1) { // Safety check for cases like 'Fb' or 'E#'
                     displayError('×ª×• ×‘×¡×™×¡ ×œ× ×§×™×™× (×× ×”×¨××•× ×™).');
                     return;
                }
                
                const notes = formula.intervals.map(interval => scale[(rootIndex + interval) % 12]);
                
                const chordName = `${fullRoot}${type === 'maj' ? '' : (type === 'min' ? 'm' : type)}`;
                
                chordDisplay.innerHTML = `<span dir="ltr">${chordName}</span>`;

                chordNotesEl.textContent = notes.join(' - ');
                chordExplanationEl.textContent = formula.explanation;

                const aliasRoot = ENHARMONICS[fullRoot];
                if (aliasRoot) {
                    const aliasType = type === 'maj' ? '' : (type === 'min' ? 'm' : type);
                    chordAliasesEl.textContent = `${aliasRoot}${aliasType}`;
                } else {
                    chordAliasesEl.textContent = '××™×Ÿ';
                }

                updateActiveButtons();
                highlightPianoKeys(notes); // Call new function to highlight piano keys
            }
            
            function displayError(message) {
                chordDisplay.textContent = '×©×’×™××”';
                chordNotesEl.textContent = message;
                chordAliasesEl.textContent = '...';
                chordExplanationEl.textContent = '...';
                clearPianoHighlight(); // Clear piano on error
            }

            function updateActiveButtons() {
                document.querySelectorAll('#input-area button').forEach(btn => {
                    btn.classList.remove('btn-active');
                    if( (btn.dataset.note && btn.dataset.note === currentChord.root) ||
                        (btn.dataset.accidental && btn.dataset.accidental === currentChord.accidental) ||
                        (btn.dataset.type && btn.dataset.type === currentChord.type) ) {
                        btn.classList.add('btn-active');
                    }
                });
            }

            function parseChordName(inputString) {
                if (!inputString) return null;
                
                const cleanedString = inputString.trim();
                const match = cleanedString.match(/^([A-G])([#b]?)(.*)$/i);
                
                if (!match) return null;

                let [, root, accidental, type] = match;
                root = root.toUpperCase();
                type = type.toLowerCase();
                
                if (type === '') { type = 'maj'; }
                if (type === 'm') { type = 'min'; }
                
                if (!CHORD_FORMULAS[type]) {
                    const knownTypes = Object.keys(CHORD_FORMULAS);
                    const foundType = knownTypes.find(t => type === t.toLowerCase());
                     if (foundType) {
                        type = foundType;
                    } else {
                        return null;
                    }
                }
                
                return { root, accidental, type };
            }

            function highlightPianoKeys(notesToHighlight) {
                // Remove all existing highlights
                clearPianoHighlight();

                // Map the notes to their piano key representation (prefer sharps for black keys)
                const pianoNotes = notesToHighlight.map(note => {
                    if (note === 'Db') return 'C#';
                    if (note === 'Eb') return 'D#';
                    if (note === 'Gb') return 'F#';
                    if (note === 'Ab') return 'G#';
                    if (note === 'Bb') return 'A#';
                    return note;
                });

                // Highlight the corresponding keys
                pianoKeys.forEach(key => {
                    if (pianoNotes.includes(key.dataset.note)) {
                        key.classList.add('highlight');
                    }
                });
            }

            function clearPianoHighlight() {
                pianoKeys.forEach(key => {
                    key.classList.remove('highlight');
                });
            }

            rootSelector.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    currentChord.root = e.target.dataset.note;
                    updateDisplay();
                }
            });

            accidentalSelector.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    currentChord.accidental = e.target.dataset.accidental;
                    updateDisplay();
                }
            });

            typeSelector.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    currentChord.type = e.target.dataset.type;
                    updateDisplay();
                }
            });

            manualSubmit.addEventListener('click', () => {
                const parsed = parseChordName(manualInput.value);
                if (parsed) {
                    currentChord = parsed;
                    updateDisplay();
                } else {
                    displayError(`×œ× ×–×•×”×” ×”××§×•×¨×“ "${manualInput.value}"`);
                }
            });
            
            manualInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    manualSubmit.click();
                }
            });

            function showModal() {
                modalBackdrop.classList.add('visible');
            }

            function hideModal() {
                modalBackdrop.classList.remove('visible');
            }

            helpBtn.addEventListener('click', showModal);
            closeModalBtn.addEventListener('click', hideModal);
            modalBackdrop.addEventListener('click', (e) => {
                if (e.target === modalBackdrop) {
                    hideModal();
                }
            });

            // Initial display update
            updateDisplay();
        });
    </script>
</body>
</html>
